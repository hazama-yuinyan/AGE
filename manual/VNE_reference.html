<!doctype html>
<html lang="ja">
<head>
  <meta http-equiv="content-language" content="ja">
  <meta charset="UTF-8">
  <meta name="keywords" content="programming,JavaScript,ゲーム,HTML5,アドベンチャーゲーム">
  <meta name="Description" content="アドベンチャーゲーム用のゲームエンジンAGEの紹介ページ。">
  <title>The VNE Reference</title>
  <link rel="stylesheet" type="text/css" href="style.css" media="all">
  <script type="text/javascript">
    if(navigator.userAgent.indexOf("iPhone") > 0 || navigator.userAgent.indexOf("Android") > 0){
      var link = document.getElementsByTagName("link")[0];
      link.href = "style_smartphone.css";
    }
  </script>
  <script type="text/javascript" src="shCore.js"></script>
  <script type="text/javascript" src="shBrushXml.js"></script>
  <script type="text/javascript" src="shBrushJScript.js"></script>
  <link rel="stylesheet" type="text/css" href="shCore.css">
  <link rel="stylesheet" type="text/css" href="shThemeDefault.css">
</head>
<body>

<header class="header">
  <h1>AGE</h1>
  <nav>
  	<h2>Table of contents</h2>
  	<ul>
      <li><a href="#abstraction">概要</a></li>
      <li><a href="#basic_rules">基本的な流れ</a></li>
      <li><a href="#about_header">ヘッダーの概要</a></li>
      <li><a href="#the_header">ヘッダーの機能詳細</a></li>
      <li><a href="#how_to_use_tags">タグの機能一覧</a></li>
      <li><a href="#about_tags">タグの機能詳細</a></li>
      <li><a href="#on_tag_properties">タグの属性の詳細</a></li>
      <li><a href="#about_variables">ユーザー定義変数とExpressoについて</a></li>
  	</ul>
  </nav>
</header>

<article>
  <section id="abstraction" class="contents">
    <h2 class="title">概要</h2>
    <div>
      <p>
        VNE(Visual Novel game Engine)は、その名の通り、ビジュアルノベルを作る際に使用できるゲームエンジンなのですが、その最大の特徴はFlashなどの外部プラグインを一切に使わないにもかかわらず、Webブラウザ上で動作させられる点です。<br>
        VNEはその基礎に、enchant.jsと呼ばれるHTML5やJavaScriptを活用したインタラクティブなコンテンツ作成の補助をしてくれるライブラリを使用しています。<br>
        そのためユーザーはDOM操作や非同期通信処理などの低レベルAPIの知識がなくとも、簡単にオリジナルゲームをWebブラウザ上で動作させられるようになっています。<br>
        VNEはそのenchant.jsの機能を利用してアドベンチャーゲームを製作する際に必要と思われるストーリーのプロット作成やユーザーインプットの制御を簡略化しつつ、ユーザーが独自の機能を追加しやすい構造をコンセプトに極力オブジェクト指向に近い形で構成されています。<br>
      </p>
    </div>
  </section>
  
  <section id="basic_rules" class="contents">
  	<h2 class="title">基本的な流れ</h2>
    <div>
      <p>
        VNEを用いてアドベンチャーゲームを作るのに最低限必要なものは、ストーリーが記述されたXMLファイルとメインのJavaScriptファイル、さらにゲームのエントリーポイントとなるhtmlファイルだけです。<br>
        これらのうち、JavaScriptファイルとHTMLファイルは誰が書いても次のようなものになるはずです。
      </p>
      <pre class="brush: javascript">
      window.onload = function(){
        game = new enchant.Game(window.innerWidth - 20, window.innerHeight - 20);
      	game.fps = 30;
      	game.onload = function(){
      		var display = new Display([
          {file_name : &quot;./sample.xml&quot;, title : &quot;ノベルゲームサンプル&quot;,
            description : &quot;ゆるゆりのSSを原作としたノベルゲームのサンプルです&quot;},
      		{file_name : &quot;./sample2.xml&quot;, title : &quot;アドベンチャーゲームサンプル&quot;,
            description : &quot;オリジナルキャラクターを使用した簡単なアドベンチャーゲームのサンプルです&quot;},
      		{file_name : &quot;./VNE_reference.xml&quot;, title : &quot;VNEリファレンス&quot;,
            description : &quot;VNEの紹介や特徴、使い方などが解説されています&quot;}]);
      	};
      	
      	game.keybind(13, 'a');		//Enterキー
      	game.keybind(32, 'b');		//スペースキー
      	game.keybind(65, 'c');		//aキー
      	game.keybind(77, 'd');		//mキー
      	game.keybind(76, 'e');		//lキー
      	game.keybind(27, 'f');		//ESCキー
      	
      	['c', 'd', 'e', 'f'].forEach(function(type){
      		this.addEventListener(type + 'buttondown', function(e) {
      			if (!this.input[type]) {
      				this.input[type] = true;
      			}
      		});
      		this.addEventListener(type + 'buttonup', function(e) {
      			if (this.input[type]) {
      				this.input[type] = false;
      			}
      		});
      	}, game);
      	
      	game.start();
      };
      </pre>

      <pre class="brush: xml">
      &lt;!DOCTYPE html&gt;
      &lt;html&gt;
          &lt;head&gt;
              &lt;meta charset="utf-8" /&gt;
              &lt;meta name="viewport" content="width=device-width, user-scalable=no" /&gt; 
              &lt;meta name="apple-mobile-web-app-capable" content="yes" /&gt; 
              &lt;meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" /&gt;
              &lt;title&gt;VNE Demo&lt;/title&gt;
              &lt;script type="text/javascript" src="enchant.js"&gt;&lt;/script&gt;
              &lt;script type="text/javascript" src="parser.js"&gt;&lt;/script&gt;
            &lt;script type="text/javascript" src="Expresso_min.js"&gt;&lt;/script&gt;
          	&lt;script type="text/javascript" src="menu_states.js"&gt;&lt;/script&gt;
          	&lt;script type="text/javascript" src="VNE.js"&gt;&lt;/script&gt;
              &lt;script type="text/javascript" src="game.js"&gt;&lt;/script&gt;
              &lt;link rel="/style.css" type="text/css" /&gt;
          &lt;/head&gt;
          &lt;body&gt;
          	&lt;div id="enchant-stage"&gt;&lt;/div&gt;
          	&lt;div id="ruler" style="display: hidden; position: absolute; font: bold large 'うずらフォント', 'MSゴシック'"&gt;&lt;/div&gt;
          	&lt;!-- options definitions --&gt;
          	&lt;div id="options"&gt;
          		&lt;p&gt;
              &lt;label&gt;テキストの表示速度:&lt;input type="range" name="text_speed" min="0.01" max="1.0" step="0.01"&gt;
                0.5
              &lt;/label&gt;
              &lt;/p&gt;
          		&lt;fieldset&gt;
          			&lt;legend&gt;サウンドの音量&lt;/legend&gt;
          			&lt;p&gt;&lt;label&gt;BGM:&lt;input type="range" name="sound_bgm" min="0" max="1" step="0.01"&gt;0.5&lt;/label&gt;&lt;/p&gt;
          			&lt;p&gt;&lt;label&gt;効果音:&lt;input type="range" name="sound_se" min="0" max="1" step="0.01"&gt;0.5&lt;/label&gt;&lt;/p&gt;
          			&lt;p&gt;&lt;label&gt;操作音:&lt;input type="range" name="sound_ope" min="0" max="1" step="0.01"&gt;0.5&lt;/label&gt;&lt;/p&gt;
          		&lt;/fieldset&gt;
          		&lt;p&gt;
              &lt;label&gt;自動テキスト送り機能の間隔設定:&lt;input type="range" name="auto_scroll_delta" min="0" max="300" step="1"&gt;
                60
              &lt;/label&gt;
              &lt;/p&gt;
          		&lt;p&gt;&lt;button id="apply_button" type="button"&gt;適用&lt;/button&gt;&lt;/p&gt;
          	&lt;/div&gt;
          &lt;/body&gt;
      &lt;/html&gt;
      </pre>
      <p>
        JavaScriptファイルの内容について特筆すべき点はDisplayコンストラクタに渡すオブジェクトでしょう。ここにスクリプトファイルへのパス、タイトルとその物語の説明を引数として渡します。このとき、配列として複数のオブジェクトを同時に渡すことができますが、ひとつの場合にも配列として渡さなければなりません。<br>
        HTMLファイルについても特筆すべきことは特にないでしょう。一つ注意すべき点として、"ruler"というidが付いたdiv要素の存在です。これはVNE内部で、あるテキストを画面上に表示する際の大きさを調べるためのテスト要素として使用されます。この要素を用意しないとメッセージウインドウなどの大きさが適切にセットされなくなる可能性があります。
      </p>
      <p>
        さて、ここからはVNEの核心とも言えるXMLファイルの記述について述べましょう。<br>
        まず、スクリプトファイルとして使用するXMLファイルが満たすべき条件は次のとおりです。
      </p>
      <ol>
        <li>必ずルート要素を用意してください（いきなりheaderなどのVNEが解釈できるタグを使わない）: Scenarioタグを使用する</li>
        <li>具体的なプロットを定義する前にheaderタグを用いてそのファイル全体に適用される設定を明確化しておく</li>
        <li>aaaaaaaaaaaa</li>
      </ol>
      <p>
        なお、以下このリファレンスでのスクリプトとは、一連のイベントの流れやその中のテキスト、簡単なUIの定義、その見た目などの記述を行うXMLファイルのことを指すこととします。
      </p>
    </div>
  </section>

  <section id="about_header" class="contents">
    <h2 class="title">ヘッダーの概要</h2>
    <div>
      <p>
        ひとつ、例え話をしましょう。例えば、好きなWebページを見に行った時に、ページの内容に合わせてレイアウトや、見た目が装飾されていますよね？<br>
        Webページの場合、HTMLとCSSを使ってそれを記述するわけですが、VNEにおいて、その役割を担うのがヘッダーというものです。
      </p>
      <p>ヘッダーは、前節で説明したXMLファイルの先頭に記述します。ヘッダー内に記述できるタグの詳細は、次節で説明しますが、</p>
    </div>
  </section>

  <section id="the_header" class="contents">
    <h2 class="title">ヘッダーの機能詳細</h2>
    <section class="tag_explanation">
      <h3>variables</h3>
      <p>
        本文中で参照できる変数を定義します。このヘッダーで定義していない変数をいきなり本文中のみで、参照することはできません。<br>
        未定義変数を参照してバグを出すことは、特に初心者が陥りやすい落とし穴なので、それを防ぐための措置です。<br>
        子タグ、varの中身は、初期値になります。後述のExpresso_miniを使用することで値を書き換えることができます。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;variables&gt;
            &lt;var name=&quot;some_var&quot;&gt;100&lt;var&gt;
          &lt;/variables&gt;
        </pre>
      </div>
      <div>
        <table>
          <caption>子タグと属性</caption>
          <thead>
            <tr>
              <td>タグ名/属性名</td><td>中身の説明</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>var</td><td>変数の初期値</td>
            </tr>
            <tr>
              <td>name</td><td>変数名</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>characters</h3>
      <p>
        本文中に登場するキャラクターの名前設定です。スクリプトで参照するキー名と、ゲーム中に表示する表示名を設定します。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;characters&gt;
            &lt;chara name=&quot;snowman&quot;&gt;スノーマン&lt;chara&gt;
          &lt;/characters&gt;
        </pre>
      </div>
      <div>
        <table>
          <caption>子タグと属性</caption>
          <thead>
            <tr>
              <td>タグ名/属性名</td><td>中身の説明</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>chara</td><td>画面上に表示する名前</td>
            </tr>
            <tr>
              <td>name</td><td>スクリプト内で参照するキャラ名</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>colors</h3>
      <p>
        キャラクターの色設定を行います。メッセージウインドウの枠の色などに使用されます。  
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;colors&gt;
            &lt;color name=&quot;snowman&quot;&gt;rgb(0, 30, 255)&lt;color&gt;
          &lt;/colors&gt;
        </pre>
      </div>
      <div>
        <table>
          <caption>子タグと属性</caption>
          <thead>
            <tr>
              <td>タグ名/属性名</td><td>中身の説明</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>color</td><td>キャラクターの色設定。メッセージウインドウの外枠の色などに使用されます</td>
            </tr>
            <tr>
              <td>name</td><td>スクリプト内で参照するキャラ名</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>paths</h3>
      <p>
        各種リソースのパスを指定します。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;paths&gt;
            &lt;path name=&quot;img_snowman&quot;&gt;images/snowman.png&lt;chara&gt;
          &lt;/paths&gt;
        </pre>
      </div>
      <div>
        <table>
          <caption>子タグと属性</caption>
          <thead>
            <tr>
              <td>タグ名/属性名</td><td>中身の説明</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>path</td><td>リソースファイルへの相対パス</td>
            </tr>
            <tr>
              <td>kind</td><td>リソースの種類; image, sound, bgmのいずれか</td>
            </tr>
            <tr>
              <td>name</td><td>スクリプト内で参照できるリソース名。VariableStoreに格納される変数名にもなります</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>settings</h3>
      <p>
        ゲームの各種パラメータ設定を行います。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;settings&gt;
            &lt;setting name=&quot;br_icon&quot;&gt;$paths.br_icon&lt;chara&gt;
          &lt;/settings&gt;
        </pre>
      </div>
      <div>
        <table>
          <caption>子タグと属性</caption>
          <thead>
            <tr>
              <td>タグ名/属性名</td><td>中身の説明</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>setting</td><td>各種設定値。例にある通り、VariableStoreの値を参照することもできます</td>
            </tr>
            <tr>
              <td>name</td><td>設定名</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>profile</h3>
      <p>
        キャラクターごとのメッセージウインドウのデザインや、立ち絵の設定を行います。  
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;profile name=&quot;snowman&quot; style=&quot;border: outset 3px $snowman.color; border-radius: 10px; color: $snowman.color; background-color: $gray; font: normal large 'うずらフォント', sans-serif;&quot;&gt;
            &lt;frame name=&quot;normal&quot;&gt;0&lt;/frame&gt;
          &lt;/profile&gt;
        </pre>
      </div>
      <div>
        <table>
          <caption>子タグと属性</caption>
          <thead>
            <tr>
              <td>タグ名/属性名</td><td>中身の説明</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>name(profileの属性)</td><td>設定対象となるキャラクターのキー名</td>
            </tr>
            <tr>
              <td>style</td><td>設定対象キャラクターのメッセージウインドウに適用するCSSスタイル設定</td>
            </tr>
            <tr>
              <td>frame</td><td>立ち絵画像のフレーム数</td>
            </tr>
            <tr>
              <td>name</td><td>スクリプト内で参照するフレーム名</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>style</h3>
      <p>
        本文中に登場するキャラクターの名前設定です。スクリプトで参照するキー名と、ゲーム中に表示する表示名を設定します。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;style name=&quot;title&quot; x=&quot;centered&quot; y=&quot;$msg_window.y/2&quot; width=&quot;adjust&quot; style=&quot;background-color: transparent; font: bold xx-large 'うずらフォント', serif;&quot;/&gt;
        </pre>
      </div>
      <div>
        <table>
          <caption>属性</caption>
          <thead>
            <tr>
              <td>属性名</td><td>中身の説明</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>name</td><td>スタイリング対象の名前</td>
            </tr>
            <tr>
              <td>x</td><td>X座標</td>
            </tr>
            <tr>
              <td>y</td><td>Y座標</td>
            </tr>
            <tr>
              <td>width</td><td>幅</td>
            </tr>
            <tr>
              <td>style</td><td>CSS形式文字列を使用してスタイリングを設定する</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </section>
  
  <section id="how_to_use_tags" class="contents">
  	<h2 class="title">タグの機能一覧</h2>
    <div>
      <p>タグにはHTMLと同様にプロパティーや属性と呼ばれる付加情報を設定することができます。次の表は、各タグとそのタグに使用できるプロパティーの一覧です。</p>
    </div>
  	<table>
      <caption>タグと使用できるプロパティーの一覧</caption>
      <colgroup span="1" style="background-color:rgb(255, 255, 255)">
      <colgroup>
        <col span="18" style="background-color:rgb(255, 30, 0); text-align:center;">
      </colgroup>
      <thead>
      <tfoot>
      <tr>
        <td>凡例</td><td colspan="18" style="background-color:white;">○：使用可　△：nameやeffect属性を指定した場合のみ使用可。指定したエフェクトに対応して使用可能になるものは異なります　×：使用不可</td>
      </tr>
      </tfoot>
      <tr>
        <th>タグ名</th><th>title</th><th>scene</th><th>narrative</th><th>narrativef</th><th>line</th><th>br/cp</th>
        <th>pause</th><th>text</th><th>eval</th><th>choice</th><th>menu</th><th>jump</th><th>effect</th><th>label</th><th>image</th>
        <th>sound</th><th>log</th><th>ruby</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td>id</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td class="ta">○</td><td class="ta">○</td><td class="ta">○</td><td class="ta">○</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
  	    <td>style</td><td class="ta">○</td><td class="ta">○</td><td class="ta">○</td><td class="ta">○</td><td class="ta">○</td><td>×</td>
        <td>×</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td class="ta">○</td><td>×</td><td>×</td>
        <td>×</td><td>×</td>
  	  </tr>
      <tr>
      	  <td>chara</td><td>×</td><td>×</td><td>×</td><td>×</td><td class="ta">○</td><td>×</td><td>×</td>
      	<td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>title</td><td>×</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
      	<td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>x</td><td class="ta">○</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
      	<td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td class="ta">○</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>y</td><td class="ta">○</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td class="ta">○</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>width</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>enable_if</td><td class="ta">○</td><td class="ta">○</td><td class="ta">○</td><td class="ta">○</td><td class="ta">○</td>
        <td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td class="ta">○</td><td class="ta">○</td><td class="ta">○</td><td class="ta">○</td>
        <td class="ta">○</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>sync</td><td class="ta">○</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td>×</td><td class="ta">○</td><td class="ta">○</td><td class="ta">○</td><td class="ta">○</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>end_time</td><td class="ta">○</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td>×</td><td class="ta">○</td><td class="ta">○</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>should_be_front</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td>×</td><td class="ta">○</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  	    <td>operation</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td class="ta">○</td><td class="ta">○</td><td class="ta">○</td><td class="ta">○</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>to</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td class="ta">○</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>action</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>src</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td class="ta">○</td><td class="ta">○</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>name</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>target</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td class="ta">○</td><td>×</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>text_speed</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td class="ta">○</td><td>×</td>
        <td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
  		  <td>time</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td class="ta">○</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>is_bgm</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td class="ta">○</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>effect</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td>×</td><td class="ta">○</td><td class="ta">○</td><td class="ta">○</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>shows_title</td><td>×</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>initial_state</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>back</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>expr</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td class="ta">○</td>
        <td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>figure_pos</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
  	  <tr>
      	<td>frame</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td class="ta">○</td><td>×</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
        <td>rtext</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td class="ta">○</td>
      </tr>
      <tr>
      	<td>amplitude_x</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>amplitude_y</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>rate</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>max_rate</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>delta_time</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>delta_frame</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>remove_when_out</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
        <td>value</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
        <td>is_visible</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>vx</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>vy</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>ax</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td>×</td><td>×</td>
  	  </tr>
      <tr>
      	<td>ay</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td><td>×</td>
        <td>×</td><td>×</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td class="to">△</td><td>×</td><td>×</td>
  	  </tr>
  	  </tbody>
  	</table>
  </section>
  
  <section id="about_tags" class="contents">
    <h2 class="title">タグの機能詳細</h2>
    <section class="tag_explanation">
      <h3>title</h3>
      <p>
        名前通り、そのお話のタイトルを設定します。タイトルはsync属性のついたlabelとして処理され、一定時間画面に表示された後消えて次のタグに制御が移ります。<br>
        なお、titleタグは存在しなくても構いません。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;title&gt;サンプル&lt;/title&gt;
        </pre>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>scene</h3>
      <p>
        一連のイベントを「シーン」としてひとまとめに扱えるようにします。「VNE」においてシーンは、物語の構成の基本単位となっており、jumpやchoiceタグのワープ先に設定できる唯一の要素です。<br>
        シーンにはそれぞれ個別の名前をつけることができます。ルートのシーンには{title}を、シーンの子になっているシーンには{id}プロパティーを設定することで名前付けできます。<br>
        この名前は同じ階層に存在するシーンの間では一意でなければならず、仮に同じ階層に同じ名前のシーンが２つ以上存在すると、後に存在するシーンはjumpやchoiceの移動先に指定できなくなります。
      </p>
      <p>
        やや専門的な話をすると、シーンは木構造で管理されます。つまり、シーンはいくらでも入れ子構造にできるわけです。<br>
        VNEでは、この木構造のシーンを名前をキー、インデックスを値としたハッシュテーブルとして瞬時に参照できるようにしています。<br>
        そのため、ユーザーは何重にもなったシーンの入れ子のパフォーマンスを心配する必要はありません。また、この管理構造のおかげで大量のシーンを定義する際に躊躇する必要がなくなっております。（どのシーンにも定数時間でアクセスできるため。一般的な線形探索では要素数に応じた計算量、ひいては計算時間がかかってしまう）
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;scene title="ルート1"&gt;
            ...
            &lt;scene id="入れ子1"&gt;
              ...
            &lt;/scene&gt;
            
            &lt;scene id="入れ子2"&gt;
              ...
            &lt;/scene&gt;
            ...
          &lt;/scene&gt;
          
          &lt;scene title="ルート2"&gt;
            ...
            &lt;scene id="入れ子1"&gt;
              ...
            &lt;/scene&gt;
          &lt;/scene&gt;
        </pre>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>narrative</h3>
      <p>
        このタグで囲ったテキストをプレイヤー（ほとんどの場合は主人公と同義）のモノローグにします。
      </p>
      <p>
        VNEでは、このnarrativeの他、後述するnarrativef,lineタグを総称して「コンテナタグ」と呼びますが、これらコンテナタグはstyle属性、またはheaderのprofileタグによってその見た目をCSS形式で自由自在に装飾することができます。<br>
        しかし、これらのタグはメッセージウインドウにテキストを表示するためCSSのプロパティーのうち、サイズや位置を制御するプロパティー（具体的にはwidth, top, leftなど）は使用できません。（これらの値は、VNEが勝手に設定します）
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;narrative&gt;サンプルテキストだよ〜ん。なんちゃらかんちゃらだーだー&lt;/narrative&gt;
        </pre>
      </div>
    </section>
    <section class="tag_explanation">
      <h3>narrativef</h3>
      <p>
        narrativeタグと同様、タグで囲ったテキストを主人公のモノローグ扱いにするものですが、こちらはテキストを画面全体に表示します。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;narrativef&gt;サンプルだよ〜ん&lt;/narrativef&gt;
        </pre>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>line</h3>
      <p>
        このタグで囲ったテキストをchara属性に指定したキャラクター名のセリフにします。<br>
        chara属性にはheaderのcharactersタグのtags属性に設定した値を使用します。そのため、XMLで使用が認められている文字（VNEでは基本的にスクリプトファイルのテキストエンコーディングにUTF-8を使用しているので、UTF-8で定義された文字）ならば何でも使用することができます。<br>
      </p>
      <p>サンプルファイルにもその例を出していますが、個人的にはいちいちIMEのオン・オフを切り替えるのが面倒なのですべて半角英数字で統一するのが楽だと思います。</p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;line chara=&quot;snowman&quot;&gt;snowmanの部分にはheaderで定義した名前を入れてね。&lt;/line&gt;
        </pre>
      </div>
    </section>
    <section class="tag_explanation">
      <h3>br/cp</h3>
      <p>brタグはHTMLにおけるそれと同じで改行を表します。一方、cpは"Change page"の略でページ切り替えを表します。</p>
      <p>
        なお、VNEはコンテナタグの終端に子タグが存在しない場合は自動的にcpタグを補います。<br>
        つまり、下記の例では「あーあー・・・」の直後に自動的にcpタグが補完され、ここでページ切り替えが行われます。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;narrative&gt;
            サンプルテキストだよ〜ん。この文章はここで&lt;br/&gt;
            改行されます。&lt;br/&gt;
            さらにここでページが切り替わります。&lt;cp/&gt;
            あーあー・・・
          &lt;/narrative&gt;
        </pre>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>pause</h3>
      <p>
        このタグの位置で{time}ミリ秒だけポーズを置きます。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;narrative&gt;サンプル&lt;pause time="250"/&gt;だよ〜ん☆&lt;/narrative&gt;
        </pre>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>text</h3>
      <p>
        このタグで囲ったテキスト部分だけ、テキストの表示速度やスタイルを変えることができます。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;narrative&gt;
            このテキストは&lt;text style="color: rgb(255, 0, 0)"&gt;赤&lt;/text&gt;で表示されます。&lt;cp/&gt;
            さらに&lt;text text_speed="0.25"&gt;このテキストはゆっくり表示&lt;/text&gt;されます。
          &lt;/narrative&gt;
        </pre>
      </div>
      <div>
        <h4>注意</h4>
        <p>textタグは内部的にはHTMLの"span"タグを用いてその機能を実現しているため、一部のプロパティーが期待通りの動作をしない場合があります。</p>
        <pre class="brush: xml">
          <!-- TODO: 期待通りの動作をしない例を挙げる-->
        </pre>
        <p>例えば上記の例では
      </div>
    </section>

    <section class="tag_explanation">
      <h3>eval</h3>
      <p>
        ユーザー定義変数の制御を行います。ユーザー定義変数については後述します。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;narrative&gt;現在の時間は&lt;eval expr="$now.hours"/&gt;:&lt;eval expr="$now.mins"/&gt;です。&lt;/narrative&gt;
        </pre>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>choice</h3>
      <p>
        選択肢を表示します。choiceタグは必ず一個以上の子要素を持ち、子要素の側にその選択肢を選択された時に移動するシーンを定義しなければなりません。<br>
        移動先のシーンの定義の仕方は、<a href="#property_to">to属性の仕様</a>をご覧ください。
      </p>
      <p>子要素のタグ名には"option"を使用します。</p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;scene title="ここ"&gt;
            &lt;choice&gt;
              &lt;option to="title:あっち"&gt;あっち行きます&lt;/option&gt;
              &lt;option to="title:どこか, ids:こっち"&gt;こっち来ます&lt;/option&gt;
              &lt;option to="title:どこか, ids:そっち"&gt;そっち行きます&lt;/option&gt;
            &lt;/choice&gt;
          &lt;/scene&gt;
          
          &lt;scene title="あっち"&gt;
            ...
          &lt;/scene&gt;
          
          &lt;scene title="どこか"&gt;
            ...
            &lt;scene id="こっち"&gt;
              ...
            &lt;/scene&gt;
            ...
            &lt;scene id="そっち"&gt;
              ...
            &lt;/scene&gt;
          &lt;/scene&gt;
        </pre>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>menu</h3>
      <p>
        choiceタグに酷似していますが、こちらはメニューを表示します。メニューの場合、選択された場合に特定のシーンに移動するほか、特殊な動作を定義することもできます。<br>
        標準状態では、「セーブ」、「ロード」、「オプションの表示」、「メインメニューへ戻る」、「別のストーリーを選択する」の５つの動作が定義されています。
      </p>
      <p>
        choiceタグと異なり、子要素のタグ名には"item"を使用します。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;scene title="main_menu" shows_title="false"&gt;
            &lt;menu initial_state="Menu"&gt;
              &lt;item x="centered" y="100" to="title:body"&gt;最初から&lt;/item&gt;
              &lt;item x="centered" y="150" to="title:ending1"&gt;終わりへ&lt/item&gt;
              &lt;item x="centered" y="200" to="title:something" enable_if="true = false"&gt;このメニューは表示されません&lt;/item&gt;
            &lt;/menu&gt;
          &lt;/scene&gt;
        </pre>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>jump</h3>
      <p>
        特定のシーンへ移動します。choiceと違ってプレイヤーに選択権はなく、強制的に移動させたい場合に使用します。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;scene title="先頭"&gt;
            このシーンに入ったら最後。あなたは無限ループにはまってしまったのだ...&lt;cp/&gt;
            &lt;jump to="title:先頭"/&gt;
          &lt;/scene&gt;
        </pre>
      </div>
      <div>
        <h4>応用例</h4>
        <p>上の例では、毎回jumpタグが有効になってしまうために無限ループに陥ってしまいましたが、enable_if属性と組み合わせることでいわゆるforやwhileループのような制御構造を実現することができます。</p>
        <pre class="brush: xml">
          &lt;eval expr="$a : 10"/&gt;
          &lt;scene title="テスト1"&gt;
            &lt;eval expr="$a : $a - 1"/&gt;
            &lt;jump to="title:テスト1" enable_if="$a > 0"/&gt;
            ...
          &lt;/scene&gt;
        </pre>
        <p>
          上記の例ではまず変数aに10をセットし、シーン：テスト1に入るたびに1ずつ減算していきます。そして、aが0以下になったらjumpタグが無効になり、それ以降のタグに制御が移るようになるわけです。<br>
          この例では簡略化のため、ループ内には変数の代入以外に処理を入れていませんが、ここに戦闘の処理を入れるなどすることで簡単な戦闘シーンを再現することができるようになることは想像に難くないでしょう。
        </p>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>effect</h3>
      <p>
        画像やラベルなどのオブジェクトにエフェクトをかけます。必ずオブジェクトが主体となるため、単独で使用する機会はありません。<br>
        
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;label id="text" x="0" y="centered" width="adjust"&gt;このテキストは左から右へ移動します&lt;/label&gt;
          &lt;effect id="move" target="$labels.text" name="Move" vx="10" vy="0"/&gt;
        </pre>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>label</h3>
      <p>画面上にラベル（素のHTML要素を含んだdiv要素）を表示します。</p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;label x="centered" y="centered" width="adjust" end_time="60"&gt;サンプル&lt;/label&gt;
        </pre>
      </div>
      <div>
        <h4>応用例</h4>
        <p>なお、やや裏技的な使い方になりますが、しっかりエスケープしておけばlabelのテキストにはHTMLのタグを使用することができます。</p>
        <pre class="brush: xml">
          &lt;label x="centered" y="centered" width="adjust"&gt;
            VNEのマニュアルは&amp;lt;a href=&amp;quot;./VNE_reference.html&amp;quot;&amp;gt;こちら&amp;lt;/a&amp;gt;をご覧ください
          &lt;/label&gt;
        </pre>
        <p>ラベルのテキストにリンクを埋め込んだ例。Webブラウザ上で動くゲームならではの強みですね。</p>
      </div>
      <div>
        <p>※labelタグは必ずsceneタグの直下に配置してください。さもないと、テキストが正しく表示されなくなります。</p>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>image</h3>
      <p>
        画面上に画像を表示します。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;image src="path_to_image" x="centered" y="centered" end_time="60"/&gt;
        </pre>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>sound</h3>
      <p>
        音声を鳴らします。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;sound src="path_to_sound" operation="once"/&gt;
        </pre>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>log</h3>
      <p>
        ブラウザのコンソールにテキストを出力します。このタグはheaderのsettingsでis_debugをtrueにしてデバッグモードにした時のみ有効になります。<br>
        このタグはevalタグを子要素に持つことができます。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;log&gt;現在の主人公のHPは&lt;eval expr="$hero_HP"/&gt;です。&lt;/log&gt;
        </pre>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>ruby</h3>
      <p>
        指定したテキストにルビを振ります。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;narrative&gt;雨の月曜日はいつも&lt;ruby rtext=&quot;ゆううつ&quot;&gt;憂鬱&lt;/ruby&gt;だ&lt;/narrative&gt;
        </pre>
      </div>
    </section>

    <section class="tag_explanation">
      <h3>minigame</h3>
      <p>
        まだ実装されていません。
      </p>
      <div>
        <h4>使用例</h4>
        <pre class="brush: xml">
          &lt;title&gt;サンプル&lt;/title&gt;
        </pre>
      </div>
    </section>
  </section>
    
  <section id="on_tag_properties" class="contents">
    <h2 class="title">タグの属性の詳細</h2>
    <section id="property_id" class="property_explanation">
      <h3>id</h3>
      <p>
        対象となる画像やラベル、音声などに一意のIDを付与します。これによってあとからそのオブジェクトに変更を加えることができるようになります。<br>
        同じオブジェクトグループ（画像なら画像だけ、ラベルならラベルだけ）の範囲内では同じIDは同時には使用できません。<br>
        しかし、そのIDのオブジェクトがその状態でただひとつしか存在しないと保証される場合に限り、同じIDを使いまわせます。
      </p>
    </section>

    <section id="property_style" class="property_explanation">
      <h3>style</h3>
      <p>
        対象となるタグにCSS形式の装飾を施します。文法はCSSに準じていますが、narrative,narrativef,キャラ名などのタグには"width", "top", "left"などのパラメーターは設定できません。（設定した場合は、単純に無視されます）<br>
        これらのタグ以外ならば"top", "left"などのパラメーターも設定できますが、後述のx,y,width属性を使用することをお勧めします。
      </p>
    </section>

    <section id="property_title" class="property_explanation">
      <h3>chara</h3>
      <p>
        対象となるセリフの主を設定します。
      </p>
    </section>

    <section id="property_title" class="property_explanation">
      <h3>title</h3>
      <p>
        対象となるシーンにjumpやchoiceの移動先として指定できる一意な名前をつけます。また、shows_title属性に"false"が設定されていなければ、この名前をサブタイトルとしてこのシーンに入る際に画面に表示します。
      </p>
    </section>

    <section id="property_x" class="property_explanation">
      <h3>x</h3>
      <p>
        ラベルや画像などのX座標を設定します。具体的な数値をベタ書きするほか、特殊なキーワードとして"centered"が用意されています。<br>
        "centered"を指定すると、ラベルや画像の中心がゲーム画面の中心に位置するようにVNEが自動的にX座標（"y"属性に設定した場合はY座標）を設定します。<br>
        なお、"centered"を使用する場合は、widthを"adjust"にしておかないと、表示がずれる原因になります。
      </p>
    </section>

    <section id="property_y" class="property_explanation">
      <h3>y</h3>
      <p>
        ラベルや画像などのY座標を設定します。設定できる値は、"x"と同じです。
      </p>
    </section>

    <section id="property_width" class="property_explanation">
      <h3>width</h3>
      <p>
        ラベルの幅を指定します。デフォルト値は300pxです。この属性を省略した場合、ラベルの内容が300pxに満たないと余計な余白部分が表示されてしまい、見た目を損ねる可能性があります。<br>
        そのため、ラベルの内容にラベル自体の幅を合わせるためのキーワードとして"adjust"が用意されています。
      </p>
    </section>

    <section id="property_enable_if" class="property_explanation">
      <h3>enable_if</h3>
      <p>
        VNEの真骨頂とも言える属性です。この属性にExpresso形式で条件式を記述しておくと、そのタグの評価時にExpressoの内容が吟味されてその条件を満たさなかった場合にはそのタグは無視されます。<br>
        これにより、たとえば"scene"タグにenable_ifを設定すればプログラミング言語におけるif文ブロックのような制御構造を実現することができます。<br>
        その他にも、特定の条件を満たした時のみ画像を表示したり、テキストを表示したり、予めフラグ変数を設定しておけばそれと組み合わせることでそれまでの行動によって選択肢を増減させるようなことも実現できます。
      </p>
    </section>

    <section id="property_sync" class="property_explanation">
      <h3>sync</h3>
      <p>
        この属性に"true"が設定されていると、そのタグの処理が完全に終わるまで次のタグに制御が移らないようになります。<br>
        具体的にはend_time属性付きのlabelの場合なら、end_timeによってそのラベルオブジェクトがディスプレイから消えるまで次のタグの処理が行われなくなります。
      </p>
    </section>

    <section id="property_end_time" class="property_explanation">
      <h3>end_time</h3>
      <p>
        ラベルなどの効果が切れるまでのフレーム数をセットします。省略すれば、remove命令などで明示的に削除しない限り、画面上から消えることはなくなります。
      </p>
    </section>

    <section id="property_should_be_front" class="property_explanation">
      <h3>should_be_front</h3>
      <p>
        "true"を設定すると、そのラベルや画像が前面に表示されるようになります。メッセージウインドウとかぶる場合に使用します。
      </p>
    </section>

    <section id="property_operation" class="property_explanation">
      <h3>operation</h3>
      <p>
        対象となるタグの動作を指定します。省略すると、対象のタグのオブジェクトをゲームに追加する"add"となります。<br>
        指定できる動作は"add", "change"(label以外), "remove"(imageのみ), "stop"(soundのみ), "loop"(soundのみ), "once"(soundのみ)です。<br>
        なお、"add"以外の動作を指定するにはオブジェクトの生成時にidを設定しておく必要があります。
      </p>
    </section>

    <section id="property_to" class="property_explanation">
      <h3>to</h3>
      <p>
        jumpやchoice、menuの子要素タグに指定してそのタグが評価されたときに移動するシーンやメニューを決定する文字列を指定します。<br>
        この属性の書式は{title:タイトルの名前(,ids:任意数のID)}で、idはカンマ区切りで0個以上記述できます。現在の実装では、同じ階層のシーンであってもタイトルやidの一部を省略することはできません。<br>
        必ずroot要素から目的のシーンまでたどり着ける「フルパス」として指定してください。<br>
        この文字列中の半角スペースとタブ文字は無視されます。そのため、タイトルやidに半角スペースが含まれる場合には"\s"という特殊文字を使わなければなりません。
      </p>
    </section>

    <section id="property_action" class="property_explanation">
      <h3>action</h3>
      <p>
        menuの子要素タグに指定してそのタグが評価されたときに実行する動作を定義します。<br>
        この動作は、プログラム中では現在のメニューの状態を定義する"MenuState"のメソッドとして実装されています。
      </p>
    </section>

    <section id="property src" class="property_explanation">
      <h3>src</h3>
      <p>
        画像やサウンドファイルのリソースを指定します。ファイルへのパス、またはpathsタグで指定した別名が設定できます。
      </p>
    </section>

    <section id="property_name" class="property_explanation">
      <h3>name</h3>
      <p>
        エフェクトの種類を指定します。標準状態では、"FadeIn", "FadeOut", "OpacityChange", "VisibilityChange", "RandomVibration", "Flicker", "Move"というエフェクトが使用できます。
      </p>
    </section>

    <section id="property_target" class="property_explanation">
      <h3>target</h3>
      <p>
        effectタグにおいては、そのエフェクトの対象となるオブジェクトをid変数形式で、imageタグではその画像が立ち絵の場合の立ち絵の主となるキャラクター名を指定します。<br>
        imageタグに立ち絵として指定する場合には、profileタグで予め指定をしておけばsrcとidを省略することができます。<br>
        この場合、idはimages.{キャラクター名}となります。<br>
        またlineタグに内包されている場合に限り、target属性の指定自体を省略することもできます。
      </p>
    </section>

    <section id="property_text_speed" class="property_explanation">
      <h3>text_speed</h3>
      <p>
        この属性を指定したtextタグの範囲のみ、テキストの表示スピードを標準スピードのtext_speedに設定した値倍にします。<br>
        つまり、通常の半分の速度にしたい場合には"0.5"を、通常の倍の速度にしたい場合は"2"を設定すればいいわけです。
      </p>
    </section>

    <section id="property_time" class="property_explanation">
      <h3>time</h3>
      <p>
        pauseタグのポーズを置く時間をミリ秒単位で指定します。
      </p>
    </section>

    <section id="property_is_bgm" class="property_explanation">
      <h3>is_bgm</h3>
      <p>
        "true"ならば、このサウンドをBGMとして扱います。（自動的にoperationにloopをセットし、前のBGMがあればまずそれを止めてからこのサウンドの再生を開始します）
      </p>
    </section>

    <section id="property_effect" class="property_explanation">
      <h3>effect</h3>
      <p>
        ラベルや画像に特定のエフェクトを適用します。設定できるエフェクト名は、name属性と同じです。
      </p>
    </section>

    <section id="property_shows_title" class="property_explanation">
      <h3>shows_title</h3>
      <p>
        "false"をセットすると、title属性のある"scene"に入った際にtitleをサブタイトルとして表示しなくなります。<br>
        なお、"true"をセットしても省略しても同じ意味になります。
      </p>
    </section>

    <section id="property_initial_state" class="property_explanation">
      <h3>initial_state</h3>
      <p>
        メニューの初期状態を設定します。
      </p>
    </section>

    <section id="property_back" class="property_explanation">
      <h3>back</h3>
      <p>
        "true"ならば、そのimageを背景として扱います。
      </p>
    </section>

    <section id="property_expr" class="property_explanation">
      <h3>expr</h3>
      <p>
        evalタグにおいて処理すべきExpressoの式を定義します。
      </p>
    </section>

    <section id="property_figure_pos" class="property_explanation">
      <h3>figure_pos</h3>
      <p>
        その画像を立ち絵として扱う場合の表示位置を設定します。設定できる値は、"left", "center", "right"の３種類です。
      </p>
    </section>

    <section id="property_figure_pos" class="property_explanation">
      <h3>frame</h3>
      <p>
        立ち絵画像の中で表示するフレームをフレーム数で指定します。フレームは、左上のフレームを0として数え始め、右下に向かって1ずつ増えていきます。
      </p>
    </section>

    <section id="property_figure_pos" class="property_explanation">
      <h3>rtext</h3>
      <p>
        ルビとして振るテキストを指定します。
      </p>
    </section>

    <section id="property_amplitude_x" class="property_explanation">
      <h3>amplitude_x</h3>
      <p>
        nameまたはeffect属性に"RandomVibration"を設定した時のみ有効になる属性です。水平方向の最大の振動幅を設定します。
      </p>
    </section>

    <section id="property_amplitude_y" class="property_explanation">
      <h3>amplitude_y</h3>
      <p>
        nameまたはeffect属性に"RandomVibration"を設定した時のみ有効になる属性です。垂直方向の最大の振動幅を設定します。
      </p>
    </section>

    <section id="property_rate" class="property_explanation">
      <h3>rate</h3>
      <p>
        nameまたはeffect属性に"FadeIn"または"FadeOut"を設定した時のみ有効になる属性です。１フレームで変化させる透明度の度合いを設定します。
      </p>
    </section>

    <section id="property_max_rate" class="property_explanation">
      <h3>max_rate</h3>
      <p>
        nameまたはeffect属性に"RandomVibration"を設定した時のみ有効になる属性です。１フレームで移動できる最大量を設定します。
      </p>
    </section>

    <section id="property_delta_time" class="property_explanation">
      <h3>delta_time</h3>
      <p>
        nameまたはeffect属性に"Flicker"を設定した時のみ有効になる属性です。点滅間隔をミリ秒単位で設定します。
      </p>
    </section>

    <section id="property_delta_frame" class="property_explanation">
      <h3>delta_frame</h3>
      <p>
        nameまたはeffect属性に"Flicker"を設定した時のみ有効になる属性です。点滅間隔をフレーム数で設定します。
      </p>
    </section>

    <section id="property_remove_when_out" class="property_explanation">
      <h3>remove_when_out</h3>
      <p>
        nameまたはeffect属性に"Move"を設定した時のみ有効になる属性です。オブジェクトがゲーム画面外に出たときに自動で削除するかどうかを設定します。
      </p>
    </section>

    <section id="property_value" class="property_explanation">
      <h3>value</h3>
      <p>
        nameまたはeffect属性に"OpacityChange"を設定した時のみ有効になる属性です。適用するアルファチャンネルの値です。
      </p>
    </section>

    <section id="property_is_visible" class="property_explanation">
      <h3>is_visible</h3>
      <p>
        nameまたはeffect属性に"VisibilityChange"を設定した時のみ有効になる属性です。オブジェクトを表示するかどうかを指定します。<br>
        不可視という意味では、"is_visible"を"false"にするのと"OpacityChange"エフェクトで"value"に"0"を設定するのは同じ効果をもたらすことになりますが、アルファチャンネルを使った場合レンダリングエンジン側の処理がなくなるわけではないので、負荷低減のために"VisibilityChange"エフェクトを使用するのがいいでしょう。
      </p>
    </section>

    <section id="property_vx" class="property_explanation">
      <h3>vx</h3>
      <p>
        nameまたはeffect属性に"Move"を設定した時のみ有効になる属性です。水平方向の速度を設定します。
      </p>
    </section>

    <section id="property_vy" class="property_explanation">
      <h3>vy</h3>
      <p>
        nameまたはeffect属性に"Move"を設定した時のみ有効になる属性です。垂直方向の速度を設定します。
      </p>
    </section>

    <section id="property_ax" class="property_explanation">
      <h3>ax</h3>
      <p>
        nameまたはeffect属性に"Move"を設定した時のみ有効になる属性です。水平方向の加速度を設定します。
      </p>
    </section>

    <section id="property_ay" class="property_explanation">
      <h3>ay</h3>
      <p>
        nameまたはeffect属性に"Move"を設定した時のみ有効になる属性です。垂直方向の加速度を設定します。
      </p>
    </section>
  </section>
  
  <section id="about_variables" class="contents">
    <h2 class="title">ユーザー定義変数とExpressoについて</h2>
    <div>
      <p>
        VNEにはスクリプトを定義するにあたって簡単な制御構造を実現し、動的なストーリーの変更を可能にしてよりリッチなコンテンツも作成できるように、組み込みのユーザー定義変数と簡易なExpressoというオリジナルのプログラミング言語パーサーを装備しております。<br>
        （プログラミング言語とは言ってもほとんど数式みたいなものですが）
      </p>
      <p>
        ユーザー定義変数はプログラム内部ではvariable_storeというオブジェクトに保存されています。ベースがJavaScriptのため、変数に型は存在せず自由に代入を繰り返すことができます。<br>
        しかし、ベースとなっているJavaScriptと異なり、このユーザー定義変数システムには配列は存在しません（スクリプトからJavaScriptの配列を取り扱う方法がないため）。<br>
        一方でオブジェクト型は存在しますが、ドット演算子は最大でも１個しか使用できません。また、これもJavaScriptとは異なる部分なのですが、ユーザー定義変数には関数は代入できません。
      </p>
      <p>
        ユーザー定義変数を使用するにはheaderのvariablesタグで予め使用する変数を宣言して初期化しておく必要があります。これは、スクリプトのあちこちで変数が定義されて他者（ここでいう他者とはスクリプトを記述してから時間が経ったユーザー自身も含みます）に混乱を招かないための配慮です。<br>
        このユーザー定義変数システムには、ユーザー自身が定義した変数以外にもheaderを元にVNEがセットする変数と予め定義された変数(predefined変数)があります。次にそれらのリストを掲載しておきます。
      </p>
      
      <h3>predefined変数</h3>
      <ul>
        <li>
          <h4>time</h4>
          <pre>
            {Object}
            @members:
                year {Number} 年
                month {Number} 月
                date {Number} 日
                day {Number} 曜日(日曜日を0、土曜日を6とする数字)
                hours {Number} 時
                mins {Number} 分
                secs {Number} 秒
                millis {Number} ミリ秒
          </pre>
        </li>
        
        <li>
          <h4>now</h4>
          <pre>
            {Object}
            @members:
                timeと同じ
          </pre>
        </li>
        
        <li>
          <h4>display</h4>
          <pre>
            {Object}
            @members:
                width {Number} ゲーム画面の幅
                height {Number} ゲーム画面の高さ
          </pre>
        </li>
        
        <li>
          <h4>msg_window</h4>
          <pre>
            {Object}
            @members:
                x {Number} メッセージウインドウのX座標
                y {Number} メッセージウインドウのY座標
                width {Number} メッセージウインドウの幅
                height {Number} メッセージウインドウの高さ
          </pre>
        </li>
        
        <li>
          <h4>file_paths</h4>
          <pre>
            {Object}
            @members:
                length {Number} VNEの起動時に設定したスクリプトファイルの数
          </pre>
        </li>
        
        <li>
          <h4>cur_frame</h4>
          <pre>
            {Number}
            ゲーム開始から現在までに経過したフレーム数
          </pre>
        </li>
      </ul>
      <h3>headerを元にした変数</h3>
      <ul>
        <li>
          <h4>paths</h4>
          <pre>
            {Object}
            @members:
                [pathsタグのnames属性にセットした名前] {String} その名前に対応するリソースへのパス
          </pre>
        </li>
        
        <li>
          <h4>settings</h4>
          <pre>
            {Object}
            @members:
                [settingsタグのnames属性にセットした名前] {String/Boolean} その名前に対応する設定
          </pre>
        </li>
        
        <li>
          <h4>{キャラクター名}</h4>
          <pre>
            {Object}
            @members:
                character {String} そのキャラクターのメッセージウインドウに表示される表示名（charactersタグでセットしたもの）
                color {String} そのキャラクターの色（colorsタグでセットしたもの）
                [profileタグのframeタグのname属性にセットしたフレーム名] {String} そのフレーム名に対応するフレーム番号
          </pre>
        </li>
      </ul>
    </div>
    
    <div>
      <h3>文法</h3>
      <p>
        Expresso(正確にはExpresso Mini)は、VNE内で共通して使える簡易のプログラミング言語です。一般的な四則演算、累乗、剰余の他に変数の参照、代入、単独不等式の評価、それらの論理和、論理積、組み込み関数の呼び出しなどをサポートしており、enable_if属性にセットして制御構造を実現したり変数の制御を行ったりします。<br>
        基本的な文法は和洋折衷ならぬ、プログラミング言語と数式との中間的なものでC言語系のプログラミング言語との相違点は、代入演算子が"="ではなく":"であること、その代わりに等価演算子が"=="でなく"="であること、
        基本的にXMLファイルに記述することを前提にしているため"&amp;"や"|"の記号が使えないことから論理積を"and"、論理和を"or"で表すことです。（尤も最後のは一部処理系では対応している場合もありますが）<br>
        ただし、Expressoにおける文は現在非常に中途半端な仕様となっており、代入式のみが文になれます。（それ以外の式も文にできなくはないのですが、評価器からのレスポンスが一切返ってこないため実質無駄になってしまいます）<br>
        文の区切りには、大半のプログラミング言語と同じくセミコロン";"を使用します。
      </p>
      <div>
        <h4>例</h4>
        <pre>
        $some_var;    //変数はこのようにドル記号を先頭につける
        $なんか変数;   //UTF-8で使える文字は何でもオッケーなので、日本語名の変数も大丈夫
        $41年;        //他の大半のプログラミング言語と違って変数名の先頭にも数字が使える
        </pre>
      </div>
      <p>
        Expressoにおいて、ドル記号"$"につづくスペースや演算子以外の文字列は変数名とみなされます。つまり、変数名には各種演算子とスペースやタブ文字など以外のUTF-8エンコーディングで使用できるあらゆる文字があてがえるわけです。<br>
        それ以外にExpressoでは、数字から始まるものは数値リテラル、演算子記号は演算子、それ以外の記号は文字列とみなされます。一般的なプログラミング言語と異なり、文字列をダブルクォーテーションで括る必要はありません。(もっともこれも、XMLに記述することを前提としているための緊急避難的な措置ですが)<br>
        その弊害として先頭に予約語や演算子が来ると文字列とみなされなくなってしまうわけですが、それらの記号はバックスラッシュでエスケープしてやることで文字列として認識させることができます。<br>
        文字列にスペースを含ませたい場合には特殊文字"\s"を使用します。
      </p>
      <div>
        <h4>例</h4>
        <pre>
        あなたが検索したキーワードは「あかりちゃん\sかわいい」です;    //これは「あなたが検索したキーワードは「あかりちゃん かわいい」です」と解釈される
        410;          //これは数字として認識される
        今日はいい天気ですね;  //これは文字列として認識される
        +-1mの差だったのにな;  //しかし、これは先頭のプラス記号が演算子と認識されてしまうため文字列にはならない
        \+-1mの差だったのにな; //バックスラッシュでエスケープすれば文字列と認識される
        </pre>
      </div>
      <p>
        このExpresso最大の特徴として、標準でtuple型をサポートしていることが挙げられます。(もっともExpresso Miniには、添字演算子が存在しないためtupleは実質後述する変数の一括代入にしか使用できませんが)<br>
        言語標準でサポートしているという事は、当然リテラルが存在するということでExpressoでは式をカンマで区切ることでtupleにすることができます。
      </p>
      
      <h3>Expressoで使用できる組み込み関数</h3>
      <p>
        <ul>
          <li>sin</li>
          <li>cos</li>
          <li>tan</li>
          <li>asin</li>
          <li>acos</li>
          <li>atan</li>
          <li>atan2</li>
          <li>abs</li>
          <li>round</li>
          <li>floor</li>
          <li>ceil</li>
          <li>exp</li>
          <li>log</li>
          <li>sqrt</li>
          <li>rand</li>
          <li>randInt</li>
        </ul>
      </p>
      <p>
        上記の関数の内、大半はJavaScriptの組み込み関数そのままなので詳しい説明は割愛します。最後の２つだけ何やら見慣れない関数名が並んでいますが、なんてことはありません。<br>
        どちらも組み込みのrandom関数の簡単なラッパーです。randは引数をひとつとり、0.0からその引数の値までか1.0までの小数(浮動小数点数)をランダムに返す関数です。一方のrandIntはその整数版です。
      </p>
    </div>
  </section>
</article>

<script type="text/javascript">
  SyntaxHighlighter.all();
</script>
</body>
</html>
